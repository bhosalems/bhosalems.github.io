<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Distance metric for fairness in vision language models | Mahesh's webpage </title> <meta name="author" content="Mahesh B"> <meta name="description" content="Distance metric for fairness"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link defer rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pseudocode@2.4.1/build/pseudocode.min.css" integrity="sha256-VwMV//xgBPDyRFVSOshhRhzJRDyBmIACniLPpeXNUdc=" crossorigin="anonymous"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://bhosalems.github.io/blog/2024/kl_distance/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Mahesh's webpage </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">curriculum-vitae </a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">teaching </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Distance metric for fairness in vision language models</h1> <p class="post-meta"> Created in November 28, 2024 </p> <p class="post-tags"> <a href="/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/kl-diveregence"> <i class="fa-solid fa-hashtag fa-sm"></i> kl-diveregence</a>   <a href="/blog/tag/self-learning"> <i class="fa-solid fa-hashtag fa-sm"></i> self-learning</a>   ·   <a href="/blog/category/technical"> <i class="fa-solid fa-tag fa-sm"></i> technical</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <h3 id="section-1-distance-metrics">Section 1: Distance metrics</h3> <p>In contrastive learning distance metric is used to bring the postive pairs closer and push negative pairs farther apart. Distance metric therefore should be chosen carefully. In case of probability distributions we will investigate whether KL divergence is good metric to use in the loss function. Distance metrics <span style="font-weight: bold;">MUST</span> satify below properties,</p> <ol> <li> <span style="font-weight: bold;">Non-Negativity</span>: \(D(P, Q) &gt;= 0\).</li> <li> <span style="font-weight: bold;">Identity of Indiscrenibles</span>: \(D(P, Q) = 0\) iff \(P==Q\).</li> <li> <span style="font-weight: bold;">Symmetry</span>: \(D(P, Q) = D(Q, P)\). Distance should not depend on the direction.</li> <li> <span style="font-weight: bold;">Triangle Inequaltiy</span>: \(D(P, Q) &lt;= D(P, R) + D(R, Q)\). Direct distance is the shortest distance.</li> </ol> <hr> <h3 id="section-2-kl-diveregence">Section 2: KL Diveregence</h3> <p>The Kullback–Leibler (KL) divergence between two probability distributions is given by,</p> \[D_{KL}(P \| Q) = \sum_x P(x) \log \frac{P(x)}{Q(x)}\] <h5 id="21-tying-with-information">2.1. Tying with Information</h5> <p>In information theory, <span style="font-weight: bold;">information</span> quantifies uncertainty reduction. For an event \(x\) with probability \(P(x)\), the information content is:</p> \[I(x) = -\log P(x)\] <p>Rare events contain more information than frequent events. The <span style="font-weight: bold;">entropy</span> of a distribution \(P\) is the expected information content:</p> \[H(P) = - \sum_x P(x) \log P(x)\] <p>KL Divergence represents the additional information required to describe samples from \(P\) using \(Q\):</p> \[D_{KL}(P \| Q) = \sum_x (P(x) \log P(x) - P(x) \log Q(x))\] <ul> <li>\(D_{KL}(P \| Q)\) measures how poorly \(Q\) approximates \(P\).</li> <li>High divergence indicates significant <span style="font-weight: bold;">information mismatch</span>.</li> </ul> <p>Therefore KL diveregence lacks the <span style="font-weight: bold;">geometric</span> intepretation of the distance and violates symmetric and triangle-inequlaity requirement i.e</p> \[D_{KL}(P \| Q) \neq D_{KL}(Q \| P)\] <p>and for example: If \(D_{KL}(P \| Q)\) is large but \(D_{KL}(Q \| R)\) is small, the sum \(D_{KL}(P \| Q) + D_{KL}(Q \| R)\) might not meaningfully bound \(D_{KL}(P \| R)\).</p> <hr> <h3 id="section-3-sinkhorn-distance">Section 3: Sinkhorn Distance</h3> <p>The Sinkhorn Distance is a regularized variant of the Wasserstein Distance, designed for computational efficiency and smoothness. It is defined as:</p> \[W_{\epsilon(D_B, D_{B_a})} = \inf_{\gamma \in \Gamma(D_B, D_{B_a})} \mathbb{E}_{(p, q) \sim \gamma}[c(p, q)] + \epsilon H(\gamma \| \mu \otimes \nu)\] <p>Where:</p> <ul> <li> <p>\(\Gamma(D_B, D_{B_a})\): The set of all joint distributions \(\gamma(p, q)\) such that:</p> \[\int \gamma(p, q) dq = D_B(p) \quad \text{first marginal matches } D_B,\] \[\int \gamma(p, q) dp = D_{B_a}(q) \quad \text{second marginal matches } D_{B_a}.\] </li> <li>\(c(p, q)\): The transport cost (e.g., Euclidean distance) between points \(p\) and \(q\).</li> <li>\(\epsilon\): A regularization parameter controlling the weight of the entropy term.</li> <li>\(H(\gamma \| \mu \otimes \nu)\): The relative entropy between \(\gamma\) and the product measure \(\mu \otimes \nu\).</li> </ul> <h5 id="31-key-components">3.1. Key Components</h5> <h6 id="joint-distribution-gamma">Joint Distribution \(\gamma\)</h6> <ul> <li>\(\gamma(p, q)\) represents a joint probability distribution over \(p\) and \(q\), where: <ul> <li>\(p\) is sampled from \(D_B\) (general batch distribution).</li> <li>\(q\) is sampled from \(D_{B_a}\) (subgroup-specific distribution).</li> </ul> </li> <li> <strong>Marginal Constraints</strong>: <ul> <li>The first marginal of \(\gamma\) is \(D_B\).</li> <li>The second marginal of \(\gamma\) is \(D_{B_a}\).</li> </ul> </li> </ul> <h6 id="transport-cost-mathbbe_p-q-sim-gammacp-q"><strong>Transport Cost \(\mathbb{E}_{(p, q) \sim \gamma}[c(p, q)]\)</strong></h6> <ul> <li>This term minimizes the cost of moving mass between \(D_B\) and \(D_{B_a}\).</li> <li>Alignment is achieved by finding an optimal \(\gamma\) that connects \(D_B\) and \(D_{B_a}\) while minimizing this cost.</li> </ul> <h6 id="regularization-term-hgamma--mu-otimes-nu"><strong>Regularization Term \(H(\gamma \| \mu \otimes \nu)\)</strong></h6> <ul> <li>\(\mu \otimes \nu\) is a general measure, not necessarily a probability measure.</li> <li>Regularization encourages \(\gamma\) to have a smoother distribution, influenced by \(\mu \otimes \nu\).</li> </ul> <hr> <h5 id="32-role-of-gamma-in-fairness-learning">3.2. Role of \(\gamma\) in Fairness Learning</h5> <p>In fairness learning, the Sinkhorn Distance aligns the distributions \(D_B\) (general) and \(D_{B_a}\) (specific to a subgroup). The joint distribution \(\gamma\):</p> <ol> <li> <p><strong>Ensures Marginal Consistency</strong>:</p> <ul> <li>\(\int \gamma(p, q) dq = D_B(p)\).</li> <li>\(\int \gamma(p, q) dp = D\_{B_a}(q)\).</li> </ul> </li> <li> <p><strong>Balances Objectives</strong>:</p> <ul> <li>Align \(D_B\) and \(D_{B_a}\) via transport cost minimization.</li> <li>Smooth the distribution \(\gamma\) via entropy regularization.</li> </ul> </li> <li> <p><strong>Optimal Transport Plan</strong>:</p> <ul> <li>\(\gamma(p, q)\) determines how much “mass” is moved from \(p\) (in \(D_B\)) to \(q\) (in \(D_{B_a}\)).</li> </ul> </li> </ol> <hr> <h5 id="33-why-sinkhorn-distance">3.3. Why Sinkhorn Distance?</h5> <p>Compared to KL Divergence:</p> <ol> <li> <strong>Handles Marginal Constraints</strong>: <ul> <li>Ensures the distributions \(D_B\) and \(D_{B_a}\) are matched via the transport plan \(\gamma\).</li> </ul> </li> <li> <strong>Incorporates Regularization</strong>: <ul> <li>The term \(H(\gamma \| \mu \otimes \nu)\) smooths \(\gamma\), making computation efficient and avoiding degenerate solutions.</li> </ul> </li> <li> <strong>True Metric</strong>: <ul> <li>Unlike KL Divergence, Sinkhorn Distance satisfies all the properties of a true metric (e.g., triangle inequality).</li> </ul> </li> </ol> <hr> <div id="disqus_thread"></div> <script type="text/javascript">var disqus_shortname="bhosalems-github-io";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}();</script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by Disqus.</a> </noscript> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/diff/">Diffusion Models Background and Code</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/sn-reid/">SoccerNet Player Re-identification</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Mahesh B. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://www.linkedin.com/in/maheshsbhosale/" target="_blank" rel="external nofollow noopener">Mahesh</a>. Last updated: December 02, 2024. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?06cae41083477f121be8cd9797ad8e2f"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0}};</script> <script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.min.js" integrity="sha256-rjmgmaB99riUNcdlrDtcAiwtLIojSxNyUFdl+Qh+rB4=" crossorigin="anonymous"></script> <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/pseudocode@2.4.1/build/pseudocode.min.js" integrity="sha256-aVkDxqyzrB+ExUsOY9PdyelkDhn/DfrjWu08aVpqNlo=" crossorigin="anonymous"></script> <script>document.addEventListener("readystatechange",()=>{"complete"===document.readyState&&document.querySelectorAll("pre>code.language-pseudocode").forEach(e=>{const t=e.textContent,d=e.parentElement.parentElement;let n=document.createElement("pre");n.classList.add("pseudocode");const o=document.createTextNode(t);n.appendChild(o),d.appendChild(n),d.removeChild(e.parentElement),pseudocode.renderElement(n)})});</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> <script type="module" src="/assets/js/search/ninja-keys.min.js?601a2d3465e2a52bec38b600518d5f70"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script>let searchTheme=determineComputedTheme();const ninjaKeys=document.querySelector("ninja-keys");"dark"===searchTheme?ninjaKeys.classList.add("dark"):ninjaKeys.classList.remove("dark");const openSearchModal=()=>{const e=$("#navbarNav");e.hasClass("show")&&e.collapse("hide"),ninjaKeys.open()};</script> <script>const ninja=document.querySelector("ninja-keys");ninja.data=[{id:"nav-about",title:"about",section:"Navigation",handler:()=>{window.location.href="/"}},{id:"nav-blog",title:"blog",description:"",section:"Navigation",handler:()=>{window.location.href="/blog/"}},{id:"nav-publications",title:"publications",description:"publications in reversed chronological order.",section:"Navigation",handler:()=>{window.location.href="/publications/"}},{id:"nav-curriculum-vitae",title:"curriculum-vitae",description:"",section:"Navigation",handler:()=>{window.location.href="/cv/"}},{id:"nav-teaching",title:"teaching",description:"Several CSE courses I have been a teaching assistant for",section:"Navigation",handler:()=>{window.location.href="/teaching/"}},{id:"post-distance-metric-for-fairness-in-vision-language-models",title:"Distance metric for fairness in vision language models",description:"Distance metric for fairness",section:"Posts",handler:()=>{window.location.href="/blog/2024/kl_distance/"}},{id:"post-diffusion-models-background-and-code",title:"Diffusion Models Background and Code",description:"Diffusion models and its code in Gaussian diffusion codebase",section:"Posts",handler:()=>{window.location.href="/blog/2024/diff/"}},{id:"post-soccernet-player-re-identification",title:"SoccerNet Player Re-identification",description:"Soccer Reidentification",section:"Posts",handler:()=>{window.location.href="/blog/2022/sn-reid/"}},{id:"news-one-paper-accepted-to-icdar-2024",title:"One paper accepted to ICDAR 2024.",description:"",section:"News"},{id:"projects-project-1",title:"project 1",description:"with background image",section:"Projects",handler:()=>{window.location.href="/projects/1_project/"}},{id:"projects-project-2",title:"project 2",description:"a project with a background image and giscus comments",section:"Projects",handler:()=>{window.location.href="/projects/2_project/"}},{id:"projects-project-3-with-very-long-name",title:"project 3 with very long name",description:"a project that redirects to another website",section:"Projects",handler:()=>{window.location.href="/projects/3_project/"}},{id:"projects-project-4",title:"project 4",description:"another without an image",section:"Projects",handler:()=>{window.location.href="/projects/4_project/"}},{id:"projects-project-5",title:"project 5",description:"a project with a background image",section:"Projects",handler:()=>{window.location.href="/projects/5_project/"}},{id:"projects-project-6",title:"project 6",description:"a project with no image",section:"Projects",handler:()=>{window.location.href="/projects/6_project/"}},{id:"projects-project-7",title:"project 7",description:"with background image",section:"Projects",handler:()=>{window.location.href="/projects/7_project/"}},{id:"projects-project-8",title:"project 8",description:"an other project with a background image and giscus comments",section:"Projects",handler:()=>{window.location.href="/projects/8_project/"}},{id:"projects-project-9",title:"project 9",description:"another project with an image \ud83c\udf89",section:"Projects",handler:()=>{window.location.href="/projects/9_project/"}},{id:"socials-orcid",title:"ORCID",section:"Socials",handler:()=>{window.open("https://orcid.org/0009-0003-7157-2129","_blank")}},{id:"socials-google-scholar",title:"Google Scholar",section:"Socials",handler:()=>{window.open("https://scholar.google.com/citations?user=HcQtx-4AAAAJ&hl","_blank")}},{id:"socials-github",title:"GitHub",section:"Socials",handler:()=>{window.open("https://github.com/bhosalems","_blank")}},{id:"socials-linkedin",title:"LinkedIn",section:"Socials",handler:()=>{window.open("https://www.linkedin.com/in/maheshsbhosale","_blank")}},{id:"socials-x",title:"X",description:"Twitter",section:"Socials",handler:()=>{window.open("https://twitter.com/ms_bhosale","_blank")}},{id:"socials-rss",title:"RSS Feed",section:"Socials",handler:()=>{window.open("/feed.xml","_blank")}},{id:"light-theme",title:"Change theme to light",description:"Change the theme of the site to Light",section:"Theme",handler:()=>{setThemeSetting("light")}},{id:"dark-theme",title:"Change theme to dark",description:"Change the theme of the site to Dark",section:"Theme",handler:()=>{setThemeSetting("dark")}},{id:"system-theme",title:"Use system default theme",description:"Change the theme of the site to System Default",section:"Theme",handler:()=>{setThemeSetting("system")}}];</script> <script src="/assets/js/shortcut-key.js"></script> </body> </html>